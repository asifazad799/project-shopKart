
{{!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.11/cropper.css"> --}}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.11/cropper.css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/dataTables.jqueryui.min.css">
                            




 <div class="container" style="font-size: 14px;" >


            <section class="mt-0 pt-0 d-flex justify-content-center loginForm" >
        <div class="container cl-10 col-sm-8 col-md-6 col-lg-5 pt-0 mt-4">
            <div class="row pb-2 p-5" style="background-color:#eeeeee; border-radius: 6px;  box-shadow:  0px 0px 20px 2px  rgb(187, 187, 187);">
                <form class="pt-0" enctype="multipart/form-data" id="add-Barnd" action="/admin/addNewBrand" method="POST">
                
                   <h3 class="text-center loginTitle mb-2">Add new Brand</h3>
                   {{#if brandErr}}
                   <p  class="text-danger text-center mt-1">{{brandErr}}</p>
                   {{/if}}
                   <div class="">
                        <label class="">Brand name</label>
                        <input type="text" class="form-control"  name="brandName" >
                        {{!-- <div id="emailHelp" class="form-text">We'll never share your data with anyone else.</div> --}}
                    </div>
                   

                        <div class="mt-2">
                        <label class="">Brand Symbol</label>
                        <div class="col-12">
                        <div id="image-box" style="width: 300px; height: 300px; display: none;"></div>
                        <button class="btn btn-primary" type="button" style="display: none;"
                            id="crop-btn">Crop</button>
                        </div>

                        <img src="" alt="" style="width: 100px; height:auto ; " id="imgview1">
                        {{!-- <div id="preview1"></div> --}}
                        <input type="file" name="image1" id="file1" style="padding-top: 5.7px;" class="form-control"
                            onchange="return fileValidation1()">
                        </div>
                    

                            





                       
                    
                    
                    <div class="row">

                    <div class="cl-lg-4 text-center mb-0">
                        <button id="confirm-btn" type="submit" class="btn btn-primary " style="background-color: blue; margin-top:20px; width: 80px">Add</button>
                    </div>
                    </div>
                </form>
                
            </div>
        </div>
    </section>

    <div class="col-12 p-4 mt-5 pt-5" style="background-color: #f9f9fa; border-radius:4px; border-radius:4px;box-shadow:  0px 0px 19px 3px  rgb(220, 220, 220)">

    
    <table id="categoryTable" class="display text-center" style="width:100%; font-size:15px !important;">
        <thead style="font-size: 15px;">
            <tr >
                <th>Index</th>
                <th>Brnd Symbol</th>
                <th>Brand Name</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {{#each data}}
        <tr>
            <td>{{@index}}</td>
            <td><img src="/images/brandSymbols/{{this._id}}.png" width="50px" height="50px" alt=""></td>
           <td>
                {{this.brandName}}
                
            </td>
            <td>

                 <a class="btn" onclick="deleteBrand('{{this._id}}')"><i class="fas fa-trash text-danger"></i></a>

            </td>
       </tr>
        {{/each}}
        </tbody>
    </table>
    </div> 
   
    </div>
    </div>
    
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.11/cropper.js"></script>

<script>
    function fileValidation1() {
        const imagebox = document.getElementById('image-box')
        const crop_btn = document.getElementById('crop-btn')
        var fileInput = document.getElementById('file1');

        var filePath = fileInput.value;
        var allowedExtensions = /(\.jpg)$/i;
        if (!allowedExtensions.exec(filePath)) {
            alert('Please upload file having extensions .jpeg only.');
            fileInput.value = '';
            return false;
        } else {
            //Image preview
            const img_data = fileInput.files[0]
            const url = URL.createObjectURL(img_data)
            imagebox.innerHTML = `<img src="${url}" id="image" style="width:100%">`
            const image = document.getElementById('image')
            document.getElementById('image-box').style.display = 'block'
            document.getElementById('crop-btn').style.display = 'block'
            document.getElementById('confirm-btn').style.display = 'none'

            const cropper = new Cropper(image, {
                autoCropArea: 1,
                viewMode: 1,
                scalable: true,
                zoomable: true,
                movable: true,
                aspectRatio: 16 / 19,
                //  preview: '.preview',
                minCropBoxWidth: 180,
                minCropBoxHeight: 240,
            })
            crop_btn.addEventListener('click', () => {
                cropper.getCroppedCanvas().toBlob((blob) => {
                    let fileInputElement = document.getElementById('file1');
                    let file = new File([blob], img_data.name, { type: "image/*", lastModified: new Date().getTime() });
                    let container = new DataTransfer();

                    container.items.add(file);
                    const img = container.files[0]
                    var url = URL.createObjectURL(img)
                    fileInputElement.files = container.files;
                    document.getElementById('imgview1').src = url
                    document.getElementById('image-box').style.display = 'none'
                    document.getElementById('crop-btn').style.display = 'none'
                    document.getElementById('confirm-btn').style.display = 'block'
                });
            });
        }
    }
</script>





<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script type="text/javascript">

      $(document).ready(function() {

      $('#categoryTable1').DataTable(); 

    } )

    function deleteBrand(id){
    {{!-- console.log('hhh') --}}
    swal({
        title: "Are you sure?",
        text: "Once deleted, you will not be able to recover data!",
        icon: "warning",
        buttons: true,
        dangerMode: true,
      })
      .then((willDelete) => {
        if (willDelete) {
            $.ajax({
                url:"/admin/deleteBrand",
                method:"post",
                data:{brandId:id},
                success:(result)=>{
                    if(result.status){
                     swal("category deleted!", {
                         icon: "success",
                       });
                       location.href="/admin/brandmanagement"
                      
         
                    }
                }
                
            })
      }
    }
    )
    };
    

</script>



    